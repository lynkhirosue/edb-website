---
import '../styles/beers.css';
import { loadBeers } from '../utils/data-loader';

export interface Props {
  className?: string;
}

const { className = "" } = Astro.props;

// Chargement et validation des donn√©es depuis JSON
const createdBeers = await loadBeers();
---

<section id="beers" class={className}>
  <div class="beers-container">
    <h2 class="beers-title">On a d√©j√† brass√©</h2>
    <p class="beers-subtitle">
      Nos cr√©ations artisanales r√©alis√©es avec passion. 
      Chaque bi√®re raconte une histoire unique de notre savoir-faire.
    </p>

    <div class="beers-grid">
      {createdBeers.map((beer) => (
        <div 
          class={`beer-card ${beer.hasSpecialEffect ? 'beer-card-special' : ''} ${beer.hasGhosts ? 'beer-card-ghosts' : ''}`}
          data-beer-id={beer.id}
        >
          {beer.hasGhosts && (
            <div class="halloween-ghosts" id={`ghosts-${beer.id}`}>
              <div class="ghost ghost-1">üëª</div>
              <div class="ghost ghost-2">üëª</div>
              <div class="ghost ghost-3">üëª</div>
            </div>
          )}

          {beer.hasSpecialEffect && beer.backgroundImage && (
            <div 
              class="beer-background-image" 
              style={`background-image: url('${beer.backgroundImage}')`}
            ></div>
          )}
          
          <div class="beer-content">
            <h3 class="beer-name">{beer.name}</h3>
            <h6 class="beer-type">{beer.type}</h6>
            <p class="beer-description">{beer.description}</p>
            
            <div class="beer-tags">
              {beer.tags.map((tag) => (
                <span class="beer-tag">{tag}</span>
              ))}
            </div>
            
            <div class="beer-footer">
              <span class="beer-abv">{beer.abv}</span>
              <button class="inspire-btn">S'en inspirer</button>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', () => {
  let hasBeenHovered = false;
  
  const ghostCard = document.querySelector('.beer-card-ghosts') as HTMLElement | null;
  
  if (ghostCard) {
    const ghostsContainer = ghostCard.querySelector('.halloween-ghosts') as HTMLElement | null;
    
    if (ghostsContainer) {
      ghostCard.addEventListener('mouseenter', () => {
        if (!hasBeenHovered) {
          hasBeenHovered = true;
          ghostsContainer.classList.add('ghosts-active');
          
          setTimeout(() => {
            ghostsContainer.style.display = 'none';
          }, 3000);
        }
      });
    }
  }
  
  document.querySelectorAll<HTMLButtonElement>('.inspire-btn').forEach(button => {
    button.addEventListener('click', (e: Event) => {
      const target = e.currentTarget as HTMLButtonElement;
      const card = target.closest('.beer-card') as HTMLElement | null;
      const beerNameEl = card?.querySelector('.beer-name');
      const beerName = beerNameEl?.textContent || '';
      
      target.style.transform = 'scale(0.95)';
      setTimeout(() => {
        target.style.transform = '';
      }, 150);
      
      const contactSection = document.querySelector('#contact') as HTMLElement | null;
      if (contactSection) {
        contactSection.scrollIntoView({ behavior: 'smooth' });
        
        setTimeout(() => {
          const messageField = document.querySelector('#message') as HTMLTextAreaElement | null;
          if (messageField) {
            messageField.value = `Bonjour ! Je suis int√©ress√©(e) par une bi√®re inspir√©e de votre "${beerName}". Pouvons-nous en discuter ?`;
            messageField.focus();
          }
        }, 1000);
      }
    });
  });
});
</script>
