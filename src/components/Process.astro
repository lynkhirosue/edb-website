---
import '../styles/process.css';

export interface Props {
  className?: string;
}

const { className = "" } = Astro.props;

// Les étapes du processus de brassage - CORRIGÉ
const brewingSteps = [
  {
    id: 'concassage',
    number: '01',
    title: 'Concassage',
    description: 'Broyage délicat du malt pour libérer les enzymes tout en préservant les enveloppes.',
    duration: '15 min',
    temperature: null, // PAS DE TEMPÉRATURE POUR LE CONCASSAGE
    icon: '🌾'
  },
  {
    id: 'empatage',
    number: '02', 
    title: 'Empâtage',
    description: 'Mélange du malt concassé avec l\'eau chaude pour convertir l\'amidon en sucres fermentescibles.',
    duration: '60-90 min',
    temperature: '62-68°C',
    icon: '🌡️'
  },
  {
    id: 'filtration',
    number: '03',
    title: 'Filtration',
    description: 'Séparation du moût sucré des drêches à travers le fond filtrant du système Grainfather.',
    duration: '45 min',
    temperature: '75-78°C',
    icon: '💧'
  },
  {
    id: 'ebullition',
    number: '04',
    title: 'Ébullition',
    description: 'Stérilisation du moût et ajout progressif des houblons pour l\'amertume et les arômes.',
    duration: '60-90 min',
    temperature: '100°C',
    icon: '♨️'
  },
  {
    id: 'refroidissement',
    number: '05',
    title: 'Refroidissement',
    description: 'Abaissement rapide de la température pour préparer l\'ensemencement en levures.',
    duration: '30 min',
    temperature: '20°C',
    icon: '❄️'
  },
  {
    id: 'fermentation',
    number: '06',
    title: 'Fermentation',
    description: 'Transformation des sucres en alcool et CO₂ par les levures dans nos fermenteurs coniques.',
    duration: '5-14 jours',
    temperature: '18-22°C',
    icon: '🧪'
  },
  {
    id: 'conditionnement',
    number: '07',
    title: 'Conditionnement',
    description: 'Mise en bouteille ou fût avec ajustement final de la carbonation et maturation.',
    duration: '2-4 semaines',
    temperature: '12-16°C',
    icon: '🍺'
  }
];
---

<section id="process" class={`process-section ${className}`} aria-labelledby="process-title">
  <div class="process-container">
    
    <div class="process-header">
      <h2 id="process-title" class="process-title">Notre Processus</h2>
      <p class="process-subtitle">
        Du grain à la bière, découvrez les 7 étapes clés de notre méthode artisanale 
        avec un contrôle précis à chaque moment.
      </p>
    </div>

    <div class="process-timeline">
      {brewingSteps.map((step, index) => (
        <article 
          class="process-step"
          data-step={step.number}
          style={`--step-index: ${index}`}
        >
          <div class="step-number">
            <span class="number-text">{step.number}</span>
          </div>
          
          <div class="step-content">
            <div class="step-icon">{step.icon}</div>
            <h3 class="step-title">{step.title}</h3>
            <p class="step-description">{step.description}</p>
            
            <div class="step-details">
              <div class="detail-item">
                <span class="detail-label">Durée</span>
                <span class="detail-value">{step.duration}</span>
              </div>
              
              <!-- TEMPÉRATURE SEULEMENT SI PERTINENTE -->
              {step.temperature && (
                <div class="detail-item">
                  <span class="detail-label">Température</span>
                  <span class="detail-value">{step.temperature}</span>
                </div>
              )}
            </div>
          </div>
        </article>
      ))}
    </div>

    <!-- Reste du code inchangé -->
    <div class="process-info">
      <div class="info-grid">
        <div class="info-card">
          <h3>🎯 Précision</h3>
          <p>Contrôle PID à ±0.5°C pour une qualité constante et reproductible.</p>
        </div>
        <div class="info-card">
          <h3>⚡ Efficacité</h3>
          <p>Système Grainfather optimisé pour un rendement maximal et un nettoyage facile.</p>
        </div>
        <div class="info-card">
          <h3>🔬 Qualité</h3>
          <p>Analyses et dégustations à chaque étape pour garantir l'excellence du produit final.</p>
        </div>
      </div>
    </div>

    <div class="process-cta">
      <h3>Envie de bière ?</h3>
      <p>Contactez-nous pour parler de vos envies et de nos créations</p>
      <a href="#contact" class="process-cta-button">
        <span>Nous contacter</span>
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M8 1l7 7-7 7M15 8H1" stroke="currentColor" stroke-width="2"/>
        </svg>
      </a>
    </div>

  </div>
</section>

<script>
  // Script inchangé
  document.addEventListener('DOMContentLoaded', () => {
    const steps = document.querySelectorAll('.process-step');
    
    const observerOptions = {
      threshold: 0.2,
      rootMargin: '0px 0px -50px 0px'
    };
    
    const stepObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('step-visible');
          
          const details = entry.target.querySelectorAll('.detail-item');
          details.forEach((detail, index) => {
            setTimeout(() => {
              detail.classList.add('detail-visible');
            }, index * 100);
          });
        }
      });
    }, observerOptions);
    
    steps.forEach(step => stepObserver.observe(step));
    
    steps.forEach(step => {
      step.addEventListener('mouseenter', () => {
        step.classList.add('step-hovered');
      });
      
      step.addEventListener('mouseleave', () => {
        step.classList.remove('step-hovered');
      });
    });
    
    document.querySelector('.process-cta-button')?.addEventListener('click', (e) => {
      e.preventDefault();
      const contact = document.querySelector('#contact');
      if (contact) {
        contact.scrollIntoView({ behavior: 'smooth' });
      }
    });
  });
</script>
