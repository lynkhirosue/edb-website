---
import '../styles/process.css';
import { loadBrewingSteps } from '../utils/data-loader';

export interface Props {
  className?: string;
}

const { className = "" } = Astro.props;

// Chargement et validation des donn√©es depuis JSON
const brewingSteps = await loadBrewingSteps();
---

<section id="process" class={`process-section ${className}`} aria-labelledby="process-title">
  <div class="process-container">
    
    <div class="process-header">
      <h2 id="process-title" class="process-title">Notre Processus</h2>
      <p class="process-subtitle">
        Du grain √† la bi√®re, d√©couvrez les 7 √©tapes cl√©s de notre m√©thode artisanale 
        avec un contr√¥le pr√©cis √† chaque moment.
      </p>
    </div>

    <div class="process-timeline">
      {brewingSteps.map((step, index) => (
        <article 
          class="process-step"
          data-step={step.number}
          style={`--step-index: ${index}`}
        >
          <div class="step-number">
            <span class="number-text">{step.number}</span>
          </div>
          
          <div class="step-content">
            <div class="step-icon">{step.icon}</div>
            <h3 class="step-title">{step.title}</h3>
            <p class="step-description">{step.description}</p>
            
            <div class="step-details">
              <div class="detail-item">
                <span class="detail-label">Dur√©e</span>
                <span class="detail-value">{step.duration}</span>
              </div>
              
              <!-- TEMP√âRATURE SEULEMENT SI PERTINENTE -->
              {step.temperature && (
                <div class="detail-item">
                  <span class="detail-label">Temp√©rature</span>
                  <span class="detail-value">{step.temperature}</span>
                </div>
              )}
            </div>
          </div>
        </article>
      ))}
    </div>

    <!-- Reste du code inchang√© -->
    <div class="process-info">
      <div class="info-grid">
        <div class="info-card">
          <h3>üéØ Pr√©cision</h3>
          <p>Contr√¥le PID √† ¬±0.5¬∞C pour une qualit√© constante et reproductible.</p>
        </div>
        <div class="info-card">
          <h3>‚ö° Efficacit√©</h3>
          <p>Syst√®me Grainfather optimis√© pour un rendement maximal et un nettoyage facile.</p>
        </div>
        <div class="info-card">
          <h3>üî¨ Qualit√©</h3>
          <p>Analyses et d√©gustations √† chaque √©tape pour garantir l'excellence du produit final.</p>
        </div>
      </div>
    </div>

    <div class="process-cta">
      <h3>Envie de bi√®re ?</h3>
      <p>Contactez-nous pour parler de vos envies et de nos cr√©ations</p>
      <a href="#contact" class="process-cta-button">
        <span>Nous contacter</span>
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M8 1l7 7-7 7M15 8H1" stroke="currentColor" stroke-width="2"/>
        </svg>
      </a>
    </div>

  </div>
</section>

<script>
  // Script inchang√©
  document.addEventListener('DOMContentLoaded', () => {
    const steps = document.querySelectorAll('.process-step');
    
    const observerOptions = {
      threshold: 0.2,
      rootMargin: '0px 0px -50px 0px'
    };
    
    const stepObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('step-visible');
          
          const details = entry.target.querySelectorAll('.detail-item');
          details.forEach((detail, index) => {
            setTimeout(() => {
              detail.classList.add('detail-visible');
            }, index * 100);
          });
        }
      });
    }, observerOptions);
    
    steps.forEach(step => stepObserver.observe(step));
    
    steps.forEach(step => {
      step.addEventListener('mouseenter', () => {
        step.classList.add('step-hovered');
      });
      
      step.addEventListener('mouseleave', () => {
        step.classList.remove('step-hovered');
      });
    });
    
    document.querySelector('.process-cta-button')?.addEventListener('click', (e) => {
      e.preventDefault();
      const contact = document.querySelector('#contact');
      if (contact) {
        contact.scrollIntoView({ behavior: 'smooth' });
      }
    });
  });
</script>
