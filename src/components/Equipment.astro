---
import '../styles/equipment.css';
import { loadEquipment } from '../utils/data-loader';
import { Image } from 'astro:assets';
import G40 from '../assets/images/G40.webp';
import GF30 from '../assets/images/GF30.webp';
import GC2 from '../assets/images/GC2.webp';

export interface Props {
  className?: string;
}

const { className = "" } = Astro.props;

// Chargement et validation des données depuis JSON
const equipmentData = await loadEquipment();

// Mapping des images pour optimisation
const imageMap: Record<string, any> = {
  '/G40.webp': G40,
  '/GF30.webp': GF30,
  '/GC2.webp': GC2
};
---

<section id="equipment" class={`equipment-section ${className}`} aria-labelledby="equipment-title">
  <div class="equipment-container">
    
    <h2 id="equipment-title" class="equipment-title">Notre Matériel</h2>
    
    <!-- Grid flex uniforme -->
    <div class="equipment-grid">
      {equipmentData.map((equipment, index) => (
        <article 
          class="equipment-card" 
          style={`--equip-index: ${index}`}
        >
          <!-- Image pleine hauteur sans fond -->
          <div class="equipment-image-container">
            <Image
              src={imageMap[equipment.image]}
              alt={equipment.name}
              class="equipment-image-full"
              width={280}
              height={280}
              loading="lazy"
              format="webp"
              quality={85}
            />
          </div>
          
          <!-- Contenu texte -->
          <div class="equipment-card-content">
            <h3 class="equipment-name">{equipment.name}</h3>
            <p class="equipment-description">{equipment.description}</p>
            <div class="capacity-badge">{equipment.capacity}</div>
          </div>
        </article>
      ))}
    </div>
    
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Animation d'entrée
    const cards = document.querySelectorAll('.equipment-card');
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('card-visible');
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    });
    
    cards.forEach(card => observer.observe(card));
  });
</script>
