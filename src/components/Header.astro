---
import '../styles/header.css';
import { Image } from 'astro:assets';
import headerScriptUrl from '../scripts/header.ts?url';
import logoImage from '../assets/images/logo-white-nobg.png';

export interface Props {
  className?: string;
}

const { className = '' } = Astro.props;
const pathname = Astro.url.pathname;
const isHome = pathname === '/';
const sectionHref = (id: string) => (isHome ? `#${id}` : `/#${id}`);

const navigationItems = [
  { label: 'Accueil', href: sectionHref('hero') },
  { label: 'La Brasserie', href: sectionHref('about') },
  { label: 'Bières', href: sectionHref('beers') },
  { label: 'Sorties', href: sectionHref('releases') },
  { label: 'Agenda', href: sectionHref('agenda') },
  { label: 'Contact', href: sectionHref('contact') }
];

function isActiveLink(href: string): boolean {
  if (href.includes('#')) {
    return isHome && href === '#hero';
  }

  if (href === '/') {
    return pathname === '/';
  }

  return pathname.startsWith(href);
}
---

<header class={`header-section ${className}`} id="header">
  <div class="header-container">
    <div class="logo-section">
      <a href="/" class="logo-link" aria-label="Retour à l'accueil">
        <Image
          src={logoImage}
          alt="Logo L'École du Bélier"
          class="logo-image"
          width={44}
          height={44}
          quality={80}
          format="webp"
        />
        <div class="logo-text">
          <div class="site-title">L'École du Bélier</div>
          <span class="site-tagline">Femto-brasserie · Nouvelle-Aquitaine</span>
        </div>
      </a>
    </div>

    <nav class="main-nav" id="site-nav" aria-label="Navigation principale">
      {navigationItems.map((item) => (
        <a
          href={item.href}
          class={`nav-link ${isActiveLink(item.href) ? 'nav-active' : ''}`}
        >
          {item.label}
        </a>
      ))}
    </nav>

    <div class="header-actions">
      <button
        class="theme-toggle"
        id="theme-toggle"
        aria-label="Basculer entre thème clair et sombre"
        title="Changer le thème"
      >
        <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" />
          <path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" />
        </svg>
        <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z" fill="currentColor" />
        </svg>
      </button>

      <a href={sectionHref('contact')} class="header-cta-button" data-analytics="cta_click" data-analytics-label="header-contact">
        <span>Contact</span>
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
          <path d="M8 1l7 7-7 7M15 8H1" stroke="currentColor" stroke-width="2" />
        </svg>
      </a>
    </div>

    <button
      class="menu-toggle"
      id="menu-toggle"
      aria-label="Ouvrir le menu de navigation"
      aria-expanded="false"
      aria-controls="site-nav"
    >
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
  </div>

  <div class="mobile-overlay" id="mobile-overlay"></div>
</header>

<script type="module" src={headerScriptUrl}></script>
